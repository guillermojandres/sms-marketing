{% extends ':Layout:layout2.html.twig' %}

{% block css %}
    {{parent()}}

      <link rel="stylesheet" href="{{ asset('Resources/dataTableM/font-awesome.min.css')}}">
     <link rel="stylesheet" href="{{ asset('Resources/dataTableM/material.min.css')}}">
    <link rel="stylesheet" href="{{ asset('Resources/dataTableM/dataTables.material.min.css')}}">
    <link rel="stylesheet" href="{{ asset('Resources/select2/dist/css/select2.css')}}">
    <link rel="stylesheet" href="{{ asset('Resources/sweetalert-master/dist/sweetalert.css')}}"> 
    <link rel="stylesheet" href="{{asset('Resources/AdminLTE-2.3.0/dist/css/skins/_all-skins.min.css')}}">
    <style type="text/css">

        .general{

          display: inline-block;
          font-weight: bold;
        }

    </style>
{% endblock css%}
{% block js %}
       {{parent()}}
       <script src="{{ asset('Resources/sweetalert-master/dist/sweetalert.min.js') }}"></script>
       <script src="{{ asset('Resources/select2/dist/js/select2.js') }}"></script>    
       <script src="{{ asset('Resources/AdminLTE-2.3.0/dist/js/app.js') }}" type="text/javascript"></script>
       <script src="{{ asset('Resources/dataTableM/jquery.dataTables.min.js') }}"></script>
       <script src="{{ asset('Resources/dataTableM/dataTables.material.min.js') }}"></script>
       <script src="{{ asset('Resources/js/clientes/clientes.js') }}"></script>


    
{% endblock %}


{% block descripcion_y_acciones %}

 <div class="row">
 {% block descripcion %}
        <div class="col-md-8">
            <p class="robo" style="font-weight: 300; margin-bottom: 0px; font-size: 30px;">Clientes</p>
            <p class="robo" style="font-weight: 300; font-size: 14px; height: 40px;">Gesti&oacute;n  de clientes</p>
        </div>
 {% endblock%}
 {% block acciones %}
                
     
                    
  <div class="col-md-4" style="margin-top: 50px;">
                          {{parent()}}
                                {# <div class="btn-group pull-right">
                                  <a href="{{ path('nuevo_identificador') }}" class="admin-menu-navi">
                                        <button class="btn btn-primary  btn-sm " style="margin-left: 5px;" id="nuevoIdentificador">Nuevo</button>
                                  </a>
                                </div>
                                <div class="btn-group pull-right">
                                        <button class="btn btn-danger  btn-sm " style="margin-left: 5px;" id="eliminarIdentificador">Eliminar</button>
                                </div> #}
                                        	
	</div>
     
 {% endblock %}
		
</div>

{% endblock %}
{% block navegacion_Y_body %}
      <div class="row">
        {% block navegacion %}
            <hr style="margin-top: 10px !important;">
            <div class="col-md-2" style="border-right: 1px solid #f3f3f3;">
                <!-- Left Navigation -->
                <ul style="list-style: none; padding: 0;">
                    <a href="{{ path('dashboard_index') }}" class="leftnava colorAnclas"><li class="leftnav left active ">Menu<span class="pull-right right"></span></li></a>

                </ul>
                 <ul style="list-style: none; padding: 0;" style="text-align:center;">
                    <p class="general " >Usuarios activos: <div id="cantidadUsuActivos" class="general" ></div></p>
                    <p class="general " >Usuarios Inactivos: <div id="cantidadUsuIncactivos" class="general"></div></p>

                </ul>
            </div>  
       
            
            
       {% endblock %}

{% block cuerpo %}
    {{parent()}}
    <div class="col-md-10" id="contenidoIndexRegistroCompraCliente">
       
     

<div class="row" style="margin-top: 10px; margin-right: 10px; display: none;" id="cont-error1">
                                    <div class="alert alert-danger" role="alert">
                                        <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                                        <span class="sr-only">Error:</span>
                                        <span id="error1"></span>
                                    </div>
</div>
                                <form id="fConsultaFactura">
                                    <div class="form-column col-sm-12" style=" padding: 20px;">
                                        <div class="form-group">
                                            <div class="row" style="margin-right: 2px;">
                                                <div class="col-sm-4"  >
                                                    <label>Nombre de Negocio:</label>
                                                    <select id="idRestaurante" name="" class="form-control input-sm " data-rule-required="true" style="width: 100%;">
                                                        <option value="0" disabled selected>Seleccione un negocio ...</option>
                                                    </select>

                                                </div>
                                                    
                                                <div class="col-sm-4">
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <label>Seleccione periodo de busqueda:</label>
                                                        </div>
                                                        <div class="col-sm-6">
                                                            <input type="text"  name="txtFechaInicio" class="form-control input-sm txtFechaIni" data-rule-required="true"
                                                                   style=" width: 100%;" id="txtFechaInicio"   placeholder="Fecha Registro">
                                                        </div>
                                                       <div class="col-sm-6"  >
                                                           <input type="text"  name="txtFechaFin" id="txtFechaFin" class="form-control input-sm txtFechaFin " data-rule-required="true"
                                                                   style=" width: 100%;"   placeholder="Fecha fin">
                                                        </div>
                                                    </div>
                                                </div>  
                                                <div class="col-sm-1"  >
                                                    <label style="color: #FFF;">Buscar</label>
                                                    <a class="btn btn-sm btn-info btn-flat pull-left" id="btnbuscar"><i class="fa  fa-search"></i>&nbsp;Buscar</a>
                                                </div>
                                            </div>
                                         </div>
                                    </div>
                                </form>
                                <form id="upload_csv" enctype="multipart/form-data" role="form" method="post">
                                    <div>
                                        <div class="col-xs-6">
                                            <label>Import CSV</label>
                                            <input type="file"  name="fileClientes" id="fileClientes" multiple="true" required>
                                            <br/>
                                        </div>
                                    </div>
                                </form>
                                <button id="subirArchivoCliente" class="btn btn-primary" name="subir">Upload</button>

                                <br>
                                <div class="clearfix"></div>                            
                                
                                <div style="margin-top: 30px; margin-left: 5px;">
                                    <table class="listados mdl-data-table" cellspacing="0" width="100%" >
                                        <thead>
                                            <tr>
                                                <th><center>Id cliente</center></th>  
                                                <th><center>Telefono</center></th>  
                                                <th><center>Fecha de registro</center></th>
                                                <th><center>Estado</center></th>
  
                                            </tr>
                                        </thead>                                       
                                    </table>
                                </div>

    
    
     </div>
    <div class="col-md-2"></div>
  

{% endblock %}

       </div>
{% endblock %}
 {% block js_extend %}

  
      <script  type="text/javascript">
          $(document).ready(function(){
               
                $('#DataTables_Table_0_filter').hide();

            var url = Routing.generate('all_clientes_data')+"?param1="+$('#idRestaurante').val()+"&param2="+$('#txtFechaInicio').val()+"&param3="+$('#txtFechaFin').val();
           
            var table = $('.listados').DataTable({
                columnDefs: [
                    {
                        targets: [ 0, 1, 2],
                        className: 'mdl-data-table__cell--non-numeric',

                    },
                    {
                        "targets": [ 0,1,2 ],
                        "orderable": true
                    },
                    {
                        "targets": [2],
                        "orderable": false
                    }

                ],
                    "pageLength": 5,
                    "lengthMenu": [ 5,10,20,50,100 ],
                    "dom": "tp",
                    "processing": true,
                    "serverSide": true,
                    "ajax": {
                        "url": url,
                        "type": 'GET'
                    },
                    "columns": [
                        {"data": "id"},
                        {"data": "telefono"},
                        {"data": "fecha_creacion"},
                        {"data": "estado"},
            
                    ],
                    "language": {
                    "info": "Mostrando página _PAGE_ de _PAGES_",
                    "infoEmpty": "",
                    "emptyTable": "No se encontraron registros",
                    "paginate": {
                        "next": "Siguiente",
                        "previous": "Anterior"
                    },
                    "processing": "Procesando petición...",
                    "search": "Buscar registros:",
                    "lengthMenu": "Mostrar _MENU_ registros"
                },
                   
            });
       
            $(document).on("click", "#btnbuscar", function(){
                $("#cantidadUsuActivos").html("");
                $("#cantidadUsuIncactivos").html("");


                var idCliente = $('#idRestaurante').val();
                
                if(idCliente!=null){
                   var url = Routing.generate('all_clientes_data')+"?param1="+$('#idRestaurante').val()+"&param2="+$('#txtFechaInicio').val()+"&param3="+$('#txtFechaFin').val();
                    table.ajax.url(url).load();

                    $.ajax({
                                                type: 'POST',
                                                async: false,
                                                dataType: 'json',
                                                data: {id:idCliente},
                                                url: Routing.generate('seleccionarCliente'),
                                                success: function (data)
                                                {
                                                     
                                                    
                                                },
                                                error: function (xhr, status)
                                                {
                                                    
                                                }
                                            });
                    
                    
                    
                    
                    
                    
                    
                }

                     var url = Routing.generate('all_clientes_data')+"?param1="+$('#idRestaurante').val()+"&param2="+$('#txtFechaInicio').val()+"&param3="+$('#txtFechaFin').val();
                     table.ajax.url(url).load();
                  


                     $.ajax({
                                    type: 'POST',
                                    async: false,
                                    dataType: 'json',
                                    data: {id:1,idRestaurante:idCliente},
                                    url: Routing.generate('extraer_usuarios'),
                                    success: function (data)
                                    {

                                         if (data.estado==true){ 
                                            $("#cantidadUsuActivos").append("<p style='color: blue; font-size:16px;text-align:right;margin-left: 20px'>"+data.activos[0].numero+"</p>");
                                            $("#cantidadUsuIncactivos").append("<p style='color: blue; font-size:16px;text-align:right;margin-left: 8px'>"+data.inactivos[0].numero+"</p>");
                                        
                                             
                                         }
                                         else{
                                             
                                                swal("Error!", "Error al extraer los datos", "error");
                                                location.reload();
                                            
                                             
                                         }

                                    },
                                    error: function (xhr, status)
                                    {
                      
                    }
            });
 
                
            });

        
     
         
        });
        
      </script>
      
      
  {% endblock %} 






















